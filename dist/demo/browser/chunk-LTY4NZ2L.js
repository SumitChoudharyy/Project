import{a as gt}from"./chunk-2R3JM6HR.js";import{a as xt}from"./chunk-LNRUO345.js";import{b as ft,c as O,d as ut,e as _t}from"./chunk-XULBARPE.js";import{a as at,b as ot,c as rt,d as pt,o as dt}from"./chunk-MCWKRJ2W.js";import{c as it}from"./chunk-DKXMDT6G.js";import"./chunk-NXT2FNZM.js";import{a as st,b as ct}from"./chunk-6EN32LWK.js";import{a as Y,b as Z}from"./chunk-HVPW2HUH.js";import"./chunk-RLT2GMJN.js";import"./chunk-5SILISN4.js";import{d as nt}from"./chunk-GYQFREEB.js";import"./chunk-6N2D2TM4.js";import{d as et}from"./chunk-5JWQYBSU.js";import{T as tt,r as X}from"./chunk-WLYOVEFQ.js";import"./chunk-VD6NAWDZ.js";import"./chunk-FJOTTGA4.js";import"./chunk-TWAJJYLZ.js";import{n as R,r as L}from"./chunk-L6X6R73V.js";import{a as mt,b as lt}from"./chunk-V7ARBOJB.js";import{Ab as k,Ba as x,Cb as _,Db as g,Eb as y,Fb as A,Ga as B,La as d,Xa as l,Xb as P,Ya as i,Yb as w,Za as e,Zb as V,_a as M,ac as N,bc as F,cb as I,dc as $,eb as b,fa as v,fb as f,ga as S,kd as j,ld as U,md as z,nd as G,od as q,pb as E,pd as H,qd as J,rd as K,sb as T,sd as Q,tb as s,ub as u,ud as W,vb as C,wb as D,xa as r}from"./chunk-SYWHXGLG.js";function Ct(n,p){n&1&&(i(0,"div",7),M(1,"mat-spinner"),e())}function ht(n,p){n&1&&(i(0,"div",11),s(1,"No complaints assigned yet."),e())}function vt(n,p){if(n&1&&(i(0,"div",23)(1,"mat-icon"),s(2,"history"),e(),i(3,"div")(4,"div")(5,"strong"),s(6),_(7,"titlecase"),e(),s(8),_(9,"date"),e(),i(10,"div"),s(11),e()()()),n&2){let t=p.$implicit;r(6),u(g(7,3,t.type)),r(2),C(" \u2022 ",y(9,5,t.createdAt,"short")),r(3),u(t.message)}}function St(n,p){if(n&1&&(i(0,"div",21)(1,"h4"),s(2,"Actions"),e(),d(3,vt,12,8,"div",22),e()),n&2){let t=f().$implicit;r(3),l("ngForOf",t.actions)}}function bt(n,p){if(n&1){let t=I();i(0,"button",24),b("click",function(){v(t);let o=f().$implicit,a=f(2);return S(a.updateStatus(o,a.ComplaintStatus.ACTIVE))}),s(1,"Mark Active"),e()}}function Mt(n,p){if(n&1){let t=I();i(0,"mat-card",12)(1,"mat-card-title"),s(2),e(),i(3,"mat-card-subtitle")(4,"span",13),s(5),_(6,"titlecase"),e(),i(7,"span"),s(8),_(9,"titlecase"),e(),i(10,"span",14),s(11),_(12,"titlecase"),e()(),i(13,"mat-card-content")(14,"p",15),s(15),e(),i(16,"div",16)(17,"span"),s(18),e(),i(19,"span"),s(20),_(21,"date"),e()(),d(22,St,4,1,"div",17),e(),M(23,"mat-divider"),i(24,"mat-card-actions"),d(25,bt,2,0,"button",18),i(26,"button",19),b("click",function(){let o=v(t).$implicit,a=f(2);return S(a.promptAddAction(o))}),s(27,"Add Action"),e(),i(28,"button",20),b("click",function(){let o=v(t).$implicit,a=f(2);return S(a.promptResolve(o))}),s(29,"Resolve"),e()()()}if(n&2){let t=p.$implicit,c=f(2);r(2),D("#",t.complaintId," \u2022 ",t.title||"No Title"),r(2),l("ngClass",t.status),r(),u(g(6,14,t.status)),r(2),T(k("chip priority ",t.priority)),r(),u(g(9,16,t.priority)),r(3),u(g(12,18,t.category)),r(4),u(t.description),r(3),C("Customer: ",t.customerId),r(2),C("Submitted: ",y(21,20,t.createdAt,"medium")),r(2),l("ngIf",t.actions==null?null:t.actions.length),r(3),l("ngIf",t.status===c.ComplaintStatus.ACTIVE)}}function It(n,p){if(n&1&&(d(0,ht,2,0,"div",8),i(1,"div",9),d(2,Mt,30,23,"mat-card",10),e()),n&2){let t=f();l("ngIf",t.assignedComplaints.length===0),r(2),l("ngForOf",t.assignedComplaints)}}function yt(n,p){n&1&&(i(0,"div",7),M(1,"mat-spinner"),e())}function Et(n,p){n&1&&(i(0,"div",11),s(1,"No unassigned complaints in your category."),e())}function Tt(n,p){if(n&1){let t=I();i(0,"mat-card",12)(1,"mat-card-title"),s(2),e(),i(3,"mat-card-subtitle")(4,"span"),s(5),_(6,"titlecase"),e(),i(7,"span",14),s(8),_(9,"titlecase"),e()(),i(10,"mat-card-content")(11,"p",15),s(12),e(),i(13,"div",16)(14,"span"),s(15),e(),i(16,"span"),s(17),_(18,"date"),e()()(),i(19,"mat-card-actions")(20,"button",20),b("click",function(){let o=v(t).$implicit,a=f(2);return S(a.assignToMe(o))}),s(21,"Assign to me"),e()()()}if(n&2){let t=p.$implicit;r(2),D("#",t.complaintId," \u2022 ",t.title||"No Title"),r(2),T(k("chip priority ",t.priority)),r(),u(g(6,10,t.priority)),r(3),u(g(9,12,t.category)),r(4),u(t.description),r(3),C("Customer: ",t.customerId),r(2),C("Submitted: ",y(18,14,t.createdAt,"medium"))}}function Dt(n,p){if(n&1&&(d(0,Et,2,0,"div",8),i(1,"div",9),d(2,Tt,22,17,"mat-card",10),e()),n&2){let t=f();l("ngIf",t.unassignedComplaints.length===0),r(2),l("ngForOf",t.unassignedComplaints)}}var oe=(()=>{let p=class p{constructor(c,o,a,m,h){this.store=c,this.complaintService=o,this.mockData=a,this.snackBar=m,this.popupService=h,this.assignedComplaints=[],this.unassignedComplaints=[],this.isLoading=!0,this.staffId=null,this.customerNameById={},this.ComplaintStatus=ft}ngOnInit(){this.store.select(L).subscribe(c=>{if(!c)return;this.staffId=c.id,this.mockData.getUsers().forEach(a=>{this.customerNameById[a.id]=`${a.firstName} ${a.lastName}`});let o=c.email.includes("billing")?O.BILLING:O.ROOM;this.reloadData(o)})}reloadData(c){this.staffId&&(this.isLoading=!0,this.complaintService.getComplaintsAssignedToStaff(this.staffId).subscribe(o=>{this.assignedComplaints=o.sort((a,m)=>new Date(m.createdAt).getTime()-new Date(a.createdAt).getTime()),this.complaintService.getComplaintsByCategoryForUnassigned(c).subscribe(a=>{this.unassignedComplaints=a.sort((m,h)=>new Date(h.createdAt).getTime()-new Date(m.createdAt).getTime()),this.isLoading=!1})}))}getCustomerName(c){return this.customerNameById[c]||c}assignToMe(c){this.staffId&&this.complaintService.assignComplaint(c.complaintId,this.staffId).subscribe(o=>{this.snackBar.open(`Assigned complaint #${o.complaintId}`,"Close",{duration:3e3});let a=o.category;this.reloadData(a)})}promptAddAction(c){this.popupService.promptSimple("Describe the action/communication/internal note:","Add Action","Enter action details...").subscribe(o=>{o&&this.staffId&&this.complaintService.addAction(c.complaintId,this.staffId,ut.STEP,o).subscribe(a=>{this.snackBar.open("Action logged","Close",{duration:2e3});let m=a.category;this.reloadData(m)})})}promptResolve(c){this.popupService.promptMultiline("Resolution details:","Resolve Complaint","Enter resolution details...").subscribe(o=>{o&&this.complaintService.resolveComplaint(c.complaintId,o).subscribe(a=>{this.snackBar.open(`Complaint #${a.complaintId} marked resolved`,"Close",{duration:3e3});let m=a.category;this.reloadData(m)})})}updateStatus(c,o){this.complaintService.updateStatus(c.complaintId,o).subscribe(a=>{this.snackBar.open(`Status updated to ${a.status}`,"Close",{duration:2e3});let m=a.category;this.reloadData(m)})}};p.\u0275fac=function(o){return new(o||p)(x(R),x(gt),x(_t),x(Y),x(xt))},p.\u0275cmp=B({type:p,selectors:[["app-staff-dashboard"]],decls:14,vars:4,consts:[["myComplaintsTpl",""],["unassignedTpl",""],[1,"staff-dashboard"],[1,"subtitle"],["label","My Complaints"],["class","section",4,"ngIf","ngIfElse"],["label","Unassigned"],[1,"section"],["class","empty-state",4,"ngIf"],[1,"cards"],["class","complaint-card",4,"ngFor","ngForOf"],[1,"empty-state"],[1,"complaint-card"],[1,"chip","status",3,"ngClass"],[1,"chip","category"],[1,"description"],[1,"meta"],["class","actions-log",4,"ngIf"],["mat-stroked-button","","color","primary",3,"click",4,"ngIf"],["mat-stroked-button","","color","accent",3,"click"],["mat-raised-button","","color","primary",3,"click"],[1,"actions-log"],["class","action",4,"ngFor","ngForOf"],[1,"action"],["mat-stroked-button","","color","primary",3,"click"]],template:function(o,a){if(o&1&&(i(0,"div",2)(1,"h1"),s(2,"Complaint Management"),e(),i(3,"p",3),s(4,"View and manage complaints assigned to you, and pick up new ones in your category."),e(),i(5,"mat-tab-group")(6,"mat-tab",4),d(7,Ct,2,0,"div",5)(8,It,3,2,"ng-template",null,0,A),e(),i(10,"mat-tab",6),d(11,yt,2,0,"div",5)(12,Dt,3,2,"ng-template",null,1,A),e()()()),o&2){let m=E(9),h=E(13);r(7),l("ngIf",a.isLoading)("ngIfElse",m),r(4),l("ngIf",a.isLoading)("ngIfElse",h)}},dependencies:[$,P,w,V,N,F,X,dt,j,z,q,Q,J,K,H,mt,at,ot,st,W,U,tt,et,G,it,nt,rt,pt,ct,Z,lt],styles:[".staff-dashboard[_ngcontent-%COMP%]{max-width:1100px;margin:0 auto;padding:24px}.subtitle[_ngcontent-%COMP%]{color:#666;margin-bottom:16px}.cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:16px}.complaint-card[_ngcontent-%COMP%]   .chip[_ngcontent-%COMP%]{padding:2px 10px;border-radius:12px;font-size:12px;margin-right:6px}.chip.priority.low[_ngcontent-%COMP%]{background:#f1f8e9;color:#558b2f}.chip.priority.medium[_ngcontent-%COMP%]{background:#fff8e1;color:#f9a825}.chip.priority.high[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.chip.category[_ngcontent-%COMP%]{background:#f5f5f5;color:#666}.chip.status.ACTIVE[_ngcontent-%COMP%]{background:#e3f2fd;color:#1976d2}.chip.status.RESOLVED[_ngcontent-%COMP%]{background:#e8f5e8;color:#2e7d32}.description[_ngcontent-%COMP%]{color:#333}.meta[_ngcontent-%COMP%]{display:flex;gap:12px;color:#777;font-size:12px;margin-top:8px}.action[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:flex-start;margin:6px 0}.empty-state[_ngcontent-%COMP%]{color:#666;padding:24px 0}"]});let n=p;return n})();export{oe as StaffDashboardComponent};
