import{b as k,c as w,g as N}from"./chunk-N2TOTUWC.js";import{C as i,W as B,Z as y,a as D,b as I,m as u,n as p}from"./chunk-ESMA6CIH.js";var T=(()=>{let a=class a{constructor(o){this.mockData=o}searchRooms(o){let t=this.mockData.getRooms().filter(e=>e.isActive);return o.roomType&&(t=t.filter(e=>e.type===o.roomType)),t=t.filter(e=>e.maxOccupancy>=o.guests),o.minPrice&&(t=t.filter(e=>e.pricePerNight>=o.minPrice)),o.maxPrice&&(t=t.filter(e=>e.pricePerNight<=o.maxPrice)),o.amenities&&o.amenities.length>0&&(t=t.filter(e=>o.amenities.every(s=>e.amenities.includes(s)))),u(t).pipe(i(1e3))}createBooking(o,t){let e=this.mockData.getBookings(),d=this.mockData.getRooms().find(n=>n.id===t.roomId);if(!d)return p(()=>"Room not found").pipe(i(500));if(e.find(n=>n.roomId===t.roomId&&n.status!==k.CANCELLED&&(t.checkInDate>=n.checkInDate&&t.checkInDate<n.checkOutDate||t.checkOutDate>n.checkInDate&&t.checkOutDate<=n.checkOutDate)))return p(()=>"Room not available for selected dates").pipe(i(500));let c=Math.ceil((t.checkOutDate.getTime()-t.checkInDate.getTime())/(1e3*60*60*24))*d.pricePerNight,m={id:(e.length+1).toString(),customerId:o,roomId:t.roomId,checkInDate:t.checkInDate,checkOutDate:t.checkOutDate,guests:t.guests,totalAmount:c,status:k.PENDING,paymentStatus:w.PENDING,specialRequests:t.specialRequests,createdAt:new Date,updatedAt:new Date};return this.mockData.addBooking(m),u(m).pipe(i(1e3))}getBookingsByCustomer(o){let t=this.mockData.getBookings().filter(e=>e.customerId===o);return u(t).pipe(i(500))}updateBooking(o,t){let e=this.mockData.updateBooking(o,I(D({},t),{updatedAt:new Date}));return e?u(e).pipe(i(500)):p(()=>"Booking not found").pipe(i(500))}cancelBooking(o,t){let s=this.mockData.getBookings().find(f=>f.id===o);if(!s)return p(()=>"Booking not found").pipe(i(500));let d=new Date,r=new Date(s.checkInDate),g=Math.ceil((r.getTime()-d.getTime())/(1e3*60*60*24)),c=0;g>=7?c=1:g>=3&&(c=.5);let m=s.totalAmount*c,n=this.mockData.updateBooking(o,{status:k.CANCELLED,cancellationReason:t,refundAmount:m,updatedAt:new Date});return n?u(n).pipe(i(1e3)):p(()=>"Failed to cancel booking").pipe(i(500))}generateInvoice(o){let e=this.mockData.getBookings().find(l=>l.id===o);if(!e)return p(()=>"Booking not found").pipe(i(500));let s=Math.ceil((e.checkOutDate.getTime()-e.checkInDate.getTime())/(1e3*60*60*24)),r=this.mockData.getRooms().find(l=>l.id===e.roomId),g=r?`${r.type.toUpperCase()} - Room ${r.roomNumber}`:"Room",c=e.totalAmount,m=c*.1,n=c+m,f={id:`INV-${e.id}`,bookingId:e.id,amount:c,tax:m,totalAmount:n,issueDate:new Date,dueDate:new Date(Date.now()+30*24*60*60*1e3),items:[{description:`${g} (${s} nights)`,quantity:s,rate:r?.pricePerNight||0,amount:c}]};return u(f).pipe(i(1e3))}};a.\u0275fac=function(t){return new(t||a)(y(N))},a.\u0275prov=B({token:a,factory:a.\u0275fac,providedIn:"root"});let h=a;return h})();export{T as a};
